<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>SfxrSynth.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">increpare</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bfxr</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">synthesis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Synthesizer</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">increpare</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bfxr</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">synthesis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IPlayerInterface</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">increpare</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bfxr</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">synthesis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">WaveWriter</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Shape</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EventDispatcher</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SampleDataEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">media</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Sound</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">media</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SoundChannel</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">media</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SoundTransform</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ByteArray</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Endian</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getTimer</span>;

    <span class="ActionScriptASDoc">/**
     * SfxrSynth
     * 
     * Copyright 2010 Thomas Vian
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * 
     * @author Thomas Vian
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">SfxrSynth</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">EventDispatcher</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">IPlayerInterface</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//  Sound Parameters
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MIN_LENGTH</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.18;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">version</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 104;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">CACHED</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"cached"</span>;        <span class="ActionScriptComment">// triggered when the synth stored in this is fully cached (either via a cache command, or play()).
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">PLAY_COMPLETE</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"playcomplete"</span>;        <span class="ActionScriptComment">// triggered when the synth stored in this is fully cached (either via a cache command, or play()).        
</span>        <span class="ActionScriptComment">//should be &lt;32
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">LoResNoisePeriod</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 8;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_params</span>:<span class="ActionScriptDefault_Text">SfxrParams</span>;    <span class="ActionScriptComment">// Params instance
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_sound</span>:<span class="ActionScriptDefault_Text">Sound</span>;                            <span class="ActionScriptComment">// Sound instance used to play the sound
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_channel</span>:<span class="ActionScriptDefault_Text">SoundChannel</span>;                    <span class="ActionScriptComment">// SoundChannel instance of playing Sound
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_mutation</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                        <span class="ActionScriptComment">// If the current sound playing or caching is a mutation
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachedWave</span>:<span class="ActionScriptDefault_Text">ByteArray</span>;                    <span class="ActionScriptComment">// Cached wave data from a cacheSound() call
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachingNormal</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                    <span class="ActionScriptComment">// If the synth is caching a normal sound
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachingMutation</span>:<span class="ActionScriptDefault_Text">int</span>;                    <span class="ActionScriptComment">// Current caching ID
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachedMutation</span>:<span class="ActionScriptDefault_Text">ByteArray</span>;                <span class="ActionScriptComment">// Current caching wave data for mutation
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachedMutations</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">&gt;</span>;    <span class="ActionScriptComment">// Cached mutated wave data
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachedMutationsNum</span>:<span class="ActionScriptDefault_Text">uint</span>;                <span class="ActionScriptComment">// Number of cached mutations
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachedMutationAmount</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// Amount to mutate during cache
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachingAsync</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                    <span class="ActionScriptComment">// If the synth is currently caching asynchronously
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cacheTimePerFrame</span>:<span class="ActionScriptDefault_Text">uint</span>;                <span class="ActionScriptComment">// Maximum time allowed per frame to cache sound asynchronously
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cachedCallback</span>:<span class="ActionScriptDefault_Text">Function</span>;                <span class="ActionScriptComment">// Function to call when finished caching asynchronously
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cacheTicker</span>:<span class="ActionScriptDefault_Text">Shape</span>;                        <span class="ActionScriptComment">// Shape used for enterFrame event
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_waveData</span>:<span class="ActionScriptDefault_Text">ByteArray</span>;                    <span class="ActionScriptComment">// Full wave, read out in chuncks by the onSampleData method
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_waveDataPos</span>:<span class="ActionScriptDefault_Text">uint</span>;                        <span class="ActionScriptComment">// Current position in the waveData
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_waveDataLength</span>:<span class="ActionScriptDefault_Text">uint</span>;                    <span class="ActionScriptComment">// Number of bytes in the waveData
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_waveDataBytes</span>:<span class="ActionScriptDefault_Text">uint</span>;                    <span class="ActionScriptComment">// Number of bytes to write to the soundcard
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_original</span>:<span class="ActionScriptDefault_Text">SfxrParams</span>;                    <span class="ActionScriptComment">// Copied properties for mutation base
</span>        
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//  Synth Variables
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_finished</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                        <span class="ActionScriptComment">// If the sound has finished
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_masterVolume</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// masterVolume * masterVolume (for quick calculations)
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_waveType</span>:<span class="ActionScriptDefault_Text">uint</span>;                            <span class="ActionScriptComment">// The type of wave to generate
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeVolume</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Current volume of the envelope
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeStage</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Current stage of the envelope (attack, sustain, decay, end)
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeTime</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Current time through current enelope stage
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeLength</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Length of the current envelope stage
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeLength0</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Length of the attack stage
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeLength1</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Length of the sustain stage
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeLength2</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Length of the decay stage
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeOverLength0</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// 1 / _envelopeLength0 (for quick calculations)
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeOverLength1</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// 1 / _envelopeLength1 (for quick calculations)
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeOverLength2</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// 1 / _envelopeLength2 (for quick calculations)
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_envelopeFullLength</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Full length of the volume envelop (and therefore sound)
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_sustainPunch</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// The punch factor (louder at begining of sustain)
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_phase</span>:<span class="ActionScriptDefault_Text">int</span>;                                <span class="ActionScriptComment">// Phase through the wave
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pos</span>:<span class="ActionScriptDefault_Text">Number</span>;                            <span class="ActionScriptComment">// Phase expresed as a Number from 0-1, used for fast sin approx
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_period</span>:<span class="ActionScriptDefault_Text">Number</span>;                            <span class="ActionScriptComment">// Period of the wave
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_periodTemp</span>:<span class="ActionScriptDefault_Text">Number</span>;                        <span class="ActionScriptComment">// Period modified by vibrato
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_maxPeriod</span>:<span class="ActionScriptDefault_Text">Number</span>;                        <span class="ActionScriptComment">// Maximum period before sound stops (from minFrequency)
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_slide</span>:<span class="ActionScriptDefault_Text">Number</span>;                            <span class="ActionScriptComment">// Note slide
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_deltaSlide</span>:<span class="ActionScriptDefault_Text">Number</span>;                        <span class="ActionScriptComment">// Change in slide
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_minFreqency</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Minimum frequency before stopping
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_muted</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                            <span class="ActionScriptComment">// Whether or not min frequency has been attained
</span>        
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_overtones</span>:<span class="ActionScriptDefault_Text">int</span>;                    <span class="ActionScriptComment">// Minimum frequency before stopping
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_overtoneFalloff</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Minimum frequency before stopping
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_vibratoPhase</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Phase through the vibrato sine wave
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_vibratoSpeed</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Speed at which the vibrato phase moves
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_vibratoAmplitude</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Amount to change the period of the wave by at the peak of the vibrato wave
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changePeriod</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changePeriodTime</span>:<span class="ActionScriptDefault_Text">int</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeAmount</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Amount to change the note by
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeTime</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Counter for the note change
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeLimit</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Once the time reaches this limit, the note changes
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeReached</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeAmount2</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Amount to change the note by
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeTime2</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Counter for the note change
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeLimit2</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Once the time reaches this limit, the note changes
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_changeReached2</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
        
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_squareDuty</span>:<span class="ActionScriptDefault_Text">Number</span>;                        <span class="ActionScriptComment">// Offset of center switching point in the square wave
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dutySweep</span>:<span class="ActionScriptDefault_Text">Number</span>;                        <span class="ActionScriptComment">// Amount to change the duty by
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_repeatTime</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Counter for the repeats
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_repeatLimit</span>:<span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptComment">// Once the time reaches this limit, some of the variables are reset
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_flanger</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                        <span class="ActionScriptComment">// If the flanger is active
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_flangerOffset</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Phase offset for flanger effect
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_flangerDeltaOffset</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Change in phase offset
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_flangerInt</span>:<span class="ActionScriptDefault_Text">int</span>;                            <span class="ActionScriptComment">// Integer flanger offset, for bit maths
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_flangerPos</span>:<span class="ActionScriptDefault_Text">int</span>;                            <span class="ActionScriptComment">// Position through the flanger buffer
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_flangerBuffer</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;            <span class="ActionScriptComment">// Buffer of wave values used to create the out of phase second wave
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_filters</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                        <span class="ActionScriptComment">// If the filters are active
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterPos</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Adjusted wave position after low-pass filter
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterOldPos</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Previous low-pass wave position
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterDeltaPos</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Change in low-pass wave position, as allowed by the cutoff and damping
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterCutoff</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Cutoff multiplier which adjusts the amount the wave position can move
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterDeltaCutoff</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// Speed of the low-pass cutoff multiplier
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterDamping</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptComment">// Damping muliplier which restricts how fast the wave position can move
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lpFilterOn</span>:<span class="ActionScriptDefault_Text">Boolean</span>;                    <span class="ActionScriptComment">// If the low pass filter is active
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_hpFilterPos</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Adjusted wave position after high-pass filter
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_hpFilterCutoff</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Cutoff multiplier which adjusts the amount the wave position can move
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_hpFilterDeltaCutoff</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// Speed of the high-pass cutoff multiplier
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_noiseBuffer</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;            <span class="ActionScriptComment">// Buffer of random values used to generate noise
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pinkNoiseBuffer</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;            <span class="ActionScriptComment">// Buffer of random values used to generate noise
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_loResNoiseBuffer</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;            <span class="ActionScriptComment">// Buffer of random values used to generate noise
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pinkNumber</span>:<span class="ActionScriptDefault_Text">PinkNumber</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_superSample</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Actual sample writen to the wave
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_sample</span>:<span class="ActionScriptDefault_Text">Number</span>;                            <span class="ActionScriptComment">// Sub-sample calculated 8 times per actual sample, averaged out to get the super sample
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_sampleCount</span>:<span class="ActionScriptDefault_Text">uint</span>;                        <span class="ActionScriptComment">// Number of samples added to the buffer sample
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bufferSample</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// Another supersample used to create a 22050Hz wave
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bitcrush_freq</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// inversely proportional to the number of samples to skip 
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bitcrush_freq_sweep</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// change of the above
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bitcrush_phase</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// samples when this &gt; 1
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bitcrush_last</span>:<span class="ActionScriptDefault_Text">Number</span>;                    <span class="ActionScriptComment">// last sample value
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_compression_factor</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//    
</span>        <span class="ActionScriptComment">//  Getters / Setters
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptASDoc">/** The sound parameters */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">SfxrParams</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_params</span>; <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">SfxrParams</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_params</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">paramsDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">updateCallback</span>:<span class="ActionScriptDefault_Text">Function</span>;
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">params</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SfxrParams</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//    
</span>        <span class="ActionScriptComment">//  Sound Methods
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptASDoc">/**
         * Plays the sound. If the parameters are dirty, synthesises sound as it plays, caching it for later. 
         * If they're not, plays from the cached sound. 
         * Won't play if caching asynchronously. 
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">play</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">updateCallback</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">volume</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//trace("playing : " + this.params.Serialize());
</span>            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingAsync</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">updateCallback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">updateCallback</span>;
            
            <span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">_mutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Dirty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Needs to cache new data
</span>                <span class="ActionScriptDefault_Text">_cachedWave</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span>;
                <span class="ActionScriptDefault_Text">_cachingNormal</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_waveData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                
                <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Play from cached data
</span>                <span class="ActionScriptDefault_Text">_waveData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span>;
                <span class="ActionScriptDefault_Text">_waveData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">_waveDataLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_waveData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
                <span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">=</span> 24576;
                <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">=</span> 0; 
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_sound</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_sound</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sound</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SampleDataEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SAMPLE_DATA</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onSampleData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">_channel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_sound</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">play</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SoundTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">volume</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Plays a mutation of the sound.  If the parameters are dirty, synthesises sound as it plays, caching it for later. 
         * If they're not, plays from the cached sound. 
         * Won't play if caching asynchronously. 
         * @param    mutationAmount    Amount of mutation
         * @param    mutationsNum    The number of mutations to cache before picking from them
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">playMutated</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mutationAmount</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.05<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mutationsNum</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 15<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">volume</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingAsync</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptDefault_Text">_mutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            
            <span class="ActionScriptDefault_Text">_cachedMutationsNum</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mutationsNum</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">paramsDirty</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// New set of mutations
</span>                <span class="ActionScriptDefault_Text">_cachedMutations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Continuing caching new mutations
</span>                <span class="ActionScriptDefault_Text">_cachedMutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span>;
                <span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_cachingMutation</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span>;
                <span class="ActionScriptDefault_Text">_waveData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                
                <span class="ActionScriptDefault_Text">_original</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mutate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mutationAmount</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Play from random cached mutation
</span>                <span class="ActionScriptDefault_Text">_waveData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">_waveData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">_waveDataLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_waveData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
                <span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">=</span> 24576;
                <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_sound</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_sound</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sound</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SampleDataEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SAMPLE_DATA</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onSampleData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">_channel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_sound</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">play</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SoundTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">volume</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Stops the currently playing sound
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channel</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_channel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_channel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_original</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_original</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_original</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * If there is a cached sound to play, reads out of the data. 
         * If there isn't, synthesises new chunch of data, caching it as it goes. 
         * @param    e    SampleDataEvent to write data to
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onSampleData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">SampleDataEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">updateCallback</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">updateCallback</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveDataPos</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span>4<span class="ActionScriptOperator">*</span>44100<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveData</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">_waveDataLength</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_waveDataLength</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_waveDataPos</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAY_COMPLETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;    
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeBytes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_waveDataPos</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_waveDataBytes</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_waveDataBytes</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">length</span>:<span class="ActionScriptDefault_Text">uint</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">l</span>:<span class="ActionScriptDefault_Text">uint</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_mutation</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_original</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span>;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">synthWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">,</span> 3072<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_original</span><span class="ActionScriptBracket/Brace">)</span>;                            
                            <span class="ActionScriptDefault_Text">_original</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                            
                            <span class="ActionScriptDefault_Text">_cachingMutation</span><span class="ActionScriptOperator">++</span>;
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 24576<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">// If the sound is smaller than the buffer length, add silence to allow it to play
</span>                                <span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">length</span>;                                                        
                                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&lt;</span>24576<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeFloat</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">_cachedMutationsNum</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">=</span> -1;
                            <span class="ActionScriptBracket/Brace">}</span>
                            
                            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CACHED</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAY_COMPLETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">updateCallback</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_waveDataPos</span>;
                        
                        <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeBytes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_waveDataPos</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_waveDataBytes</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingNormal</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span>;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">synthWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">,</span> 3072<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            
                            <span class="ActionScriptComment">// If the sound is smaller than the buffer length, add silence to allow it to play
</span>                            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&lt;</span>24576<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeFloat</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptBracket/Brace">)</span>;
                            
                            <span class="ActionScriptDefault_Text">_cachingNormal</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;                            
                            
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 24576<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">// If the sound is smaller than the buffer length, add silence to allow it to play
</span>                                <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">length</span>;                                                        
                                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&lt;</span>24576<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeFloat</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            
                            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CACHED</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAY_COMPLETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">updateCallback</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptDefault_Text">_waveDataBytes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_waveDataPos</span>;
                        
                        <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeBytes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_waveDataPos</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_waveDataBytes</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//    
</span>        <span class="ActionScriptComment">//  Cached Sound Methods
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptComment">/* whether or not it is cached*/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Dirty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">paramsDirty</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_cachingNormal</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_cachedWave</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Caching</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_cachingNormal</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">cachedWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ByteArray</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Dirty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cacheSound</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_cachedWave</span>;
        <span class="ActionScriptBracket/Brace">}</span>                
        
        <span class="ActionScriptASDoc">/** PlayerInterface implementation: */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Play</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">volume</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_mutation</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">playMutated</span><span class="ActionScriptBracket/Brace">(</span>0.05<span class="ActionScriptOperator">,</span>15<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">volume</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">play</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">volume</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Cache</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">cacheSound</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">CacheMutations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">amount</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.05<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 16<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">cacheMutations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">amount</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCachedWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ByteArray</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">cachedWave</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCachedMutationCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_cachedMutationsNum</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCachedMutationWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>-1<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ByteArray</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">==</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
                
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>        
        
        <span class="ActionScriptASDoc">/**
         * Cache the sound for speedy playback. 
         * If a callback is passed in, the caching will be done asynchronously, taking maxTimePerFrame milliseconds 
         * per frame to cache, them calling the callback when it's done. 
         * If not, the whole sound is cached imidiately - can freeze the player for a few seconds, especially in debug mode. 
         * @param    callback            Function to call when the caching is complete
         * @param    maxTimePerFrame        Maximum time in milliseconds the caching will use per frame
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">cacheSound</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callback</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">maxTimePerFrame</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 5<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">Dirty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingAsync</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">_cachedWave</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callback</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_mutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">_cachingNormal</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_cachingAsync</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_cacheTimePerFrame</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">maxTimePerFrame</span>;
                
                <span class="ActionScriptDefault_Text">_cachedCallback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">callback</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_cacheTicker</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_cacheTicker</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Shape</span>;
                
                <span class="ActionScriptDefault_Text">_cacheTicker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENTER_FRAME</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cacheSection</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_cachingNormal</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">_cachingAsync</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
                <span class="ActionScriptDefault_Text">synthWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_envelopeFullLength</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">length</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;</span> 24576<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// If the sound is smaller than the buffer length, add silence to allow it to play
</span>                    <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&lt;</span>24576<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeFloat</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CACHED</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAY_COMPLETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Caches a series of mutations on the source sound. 
         * If a callback is passed in, the caching will be done asynchronously, taking maxTimePerFrame milliseconds 
         * per frame to cache, them calling the callback when it's done. 
         * If not, the whole sound is cached imidiately - can freeze the player for a few seconds, especially in debug mode. 
         * @param    mutationsNum        Number of mutations to cache
         * @param    mutationAmount        Amount of mutation
         * @param    callback            Function to call when the caching is complete
         * @param    maxTimePerFrame        Maximum time in milliseconds the caching will use per frame
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">cacheMutations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mutationsNum</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mutationAmount</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.05<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">callback</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">maxTimePerFrame</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 5<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingAsync</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">_cachedMutationsNum</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mutationsNum</span>;
            <span class="ActionScriptDefault_Text">_cachedMutations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">_mutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callback</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>            
                <span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">_cachedMutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span>;
                <span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span>;
                <span class="ActionScriptDefault_Text">_cachedMutationAmount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mutationAmount</span>;
                
                
                <span class="ActionScriptDefault_Text">_original</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mutate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mutationAmount</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_cachingAsync</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_cacheTimePerFrame</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">maxTimePerFrame</span>;
                
                <span class="ActionScriptDefault_Text">_cachedCallback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">callback</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_cacheTicker</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_cacheTicker</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Shape</span>;
                
                <span class="ActionScriptDefault_Text">_cacheTicker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENTER_FRAME</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cacheSection</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">original</span>:<span class="ActionScriptDefault_Text">SfxrParams</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_cachedMutationsNum</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mutate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mutationAmount</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">cacheSound</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span>;
                    <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">original</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Performs the asynchronous cache, working for up to _cacheTimePerFrame milliseconds per frame
         * @param    e    enterFrame event
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">cacheSection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cacheStartTime</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getTimer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getTimer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cacheStartTime</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_cacheTimePerFrame</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_mutation</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">synthWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedMutation</span><span class="ActionScriptOperator">,</span> 500<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>                        
                        <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_original</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mutate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedMutationAmount</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptDefault_Text">_cachingMutation</span><span class="ActionScriptOperator">++</span>;
                        <span class="ActionScriptDefault_Text">_cachedMutation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span>;
                        <span class="ActionScriptDefault_Text">_cachedMutations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_cachingMutation</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedMutation</span>;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">_cachedMutationsNum</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_cachingMutation</span> <span class="ActionScriptOperator">=</span> -1;
                            <span class="ActionScriptDefault_Text">_cachingAsync</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                            
                            <span class="ActionScriptDefault_Text">_params</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">paramsDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                            
                            <span class="ActionScriptDefault_Text">_cachedCallback</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">_cachedCallback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                            <span class="ActionScriptDefault_Text">_cacheTicker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENTER_FRAME</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cacheSection</span><span class="ActionScriptBracket/Brace">)</span>;
                            
                            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CACHED</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAY_COMPLETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                            
                            <span class="ActionScriptReserved">return</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_waveDataPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">synthWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cachedWave</span><span class="ActionScriptOperator">,</span> 500<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_cachingNormal</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                        <span class="ActionScriptDefault_Text">_cachingAsync</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                        
                        <span class="ActionScriptDefault_Text">_cachedCallback</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_cachedCallback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                        <span class="ActionScriptDefault_Text">_cacheTicker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ENTER_FRAME</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cacheSection</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CACHED</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SfxrSynth</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAY_COMPLETE</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">return</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//    
</span>        <span class="ActionScriptComment">//  Synth Methods
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptComment">/* Length in quarter-seconds */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetLength</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptDefault_Text">clampTotalLength</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">SfxrParams</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_params</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">envelopeLength0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 100000.0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">envelopeLength1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 100000.0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">envelopeLength2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 100000.0 <span class="ActionScriptOperator">+</span> 10;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">envelopeLength0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">envelopeLength1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">envelopeLength2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span>44100<span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">clampTotalLength</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">SfxrParams</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_params</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">totalTime</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">totalTime</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">MIN_LENGTH</span> <span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">multiplier</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MIN_LENGTH</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">totalTime</span>;
                <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">multiplier</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">multiplier</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">multiplier</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Resets the runing variables from the params
         * Used once at the start (total reset) and for the repeat effect (partial reset)
         * @param    totalReset    If the reset is total
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">totalReset</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Shorter reference
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">SfxrParams</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_params</span>;
            
            <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">=</span> 100.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"startFrequency"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"startFrequency"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 0.001<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_maxPeriod</span> <span class="ActionScriptOperator">=</span> 100.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"minFrequency"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"minFrequency"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 0.001<span class="ActionScriptBracket/Brace">)</span>;
            
            
            <span class="ActionScriptDefault_Text">_slide</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"slide"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"slide"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"slide"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.01;
            <span class="ActionScriptDefault_Text">_deltaSlide</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"deltaSlide"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"deltaSlide"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"deltaSlide"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.000001;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"waveType"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_squareDuty</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"squareDuty"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.5;
                <span class="ActionScriptDefault_Text">_dutySweep</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"dutySweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.00005;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">_changePeriod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeRepeat"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span>0.1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>1.1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 20000 <span class="ActionScriptOperator">+</span> 32;
            <span class="ActionScriptDefault_Text">_changePeriodTime</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_changeAmount</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.9;
            <span class="ActionScriptReserved">else</span>                         <span class="ActionScriptDefault_Text">_changeAmount</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 10.0;
            
            <span class="ActionScriptDefault_Text">_changeTime</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_changeReached</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeSpeed"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 1.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_changeLimit</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">else</span>                         <span class="ActionScriptDefault_Text">_changeLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeSpeed"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeSpeed"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 20000 <span class="ActionScriptOperator">+</span> 32;
            
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount2"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_changeAmount2</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount2"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount2"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.9;
            <span class="ActionScriptReserved">else</span>                         <span class="ActionScriptDefault_Text">_changeAmount2</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount2"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeAmount2"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 10.0;
            
            
            <span class="ActionScriptDefault_Text">_changeTime2</span> <span class="ActionScriptOperator">=</span> 0;            
            <span class="ActionScriptDefault_Text">_changeReached2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeSpeed2"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 1.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_changeLimit2</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">else</span>                         <span class="ActionScriptDefault_Text">_changeLimit2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeSpeed2"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeSpeed2"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 20000 <span class="ActionScriptOperator">+</span> 32;
            
            <span class="ActionScriptDefault_Text">_changeLimit</span><span class="ActionScriptOperator">*=</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeRepeat"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span>0.1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>1.1;
            <span class="ActionScriptDefault_Text">_changeLimit2</span><span class="ActionScriptOperator">*=</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"changeRepeat"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span>0.1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>1.1;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">totalReset</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">paramsDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
                <span class="ActionScriptDefault_Text">_masterVolume</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"masterVolume"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"masterVolume"</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_waveType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"waveType"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 0.01<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptOperator">,</span> 0.01<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">clampTotalLength</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_sustainPunch</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainPunch"</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_phase</span> <span class="ActionScriptOperator">=</span> 0;
                
                <span class="ActionScriptDefault_Text">_minFreqency</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"minFrequency"</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_muted</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">_overtones</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"overtones"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>10;
                <span class="ActionScriptDefault_Text">_overtoneFalloff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"overtoneFalloff"</span><span class="ActionScriptBracket/Brace">)</span>;
                                
                <span class="ActionScriptDefault_Text">_bitcrush_freq</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"bitCrush"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>1.0<span class="ActionScriptOperator">/</span>3.0<span class="ActionScriptBracket/Brace">)</span>;                
                <span class="ActionScriptDefault_Text">_bitcrush_freq_sweep</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"bitCrushSweep"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span> 0.000015;
                <span class="ActionScriptDefault_Text">_bitcrush_phase</span><span class="ActionScriptOperator">=</span>0;
                <span class="ActionScriptDefault_Text">_bitcrush_last</span><span class="ActionScriptOperator">=</span>0;                
                
                <span class="ActionScriptDefault_Text">_compression_factor</span> <span class="ActionScriptOperator">=</span> 1<span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">+</span>4<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"compressionAmount"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_filters</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 1.0 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"hpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 0.0;                
                
                <span class="ActionScriptDefault_Text">_lpFilterPos</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptDefault_Text">_lpFilterDeltaPos</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptDefault_Text">_lpFilterCutoff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.1;
                <span class="ActionScriptDefault_Text">_lpFilterDeltaCutoff</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterCutoffSweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.0001;
                <span class="ActionScriptDefault_Text">_lpFilterDamping</span> <span class="ActionScriptOperator">=</span> 5.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterResonance"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterResonance"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 20.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>0.01 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_lpFilterCutoff</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lpFilterDamping</span> <span class="ActionScriptOperator">&gt;</span> 0.8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_lpFilterDamping</span> <span class="ActionScriptOperator">=</span> 0.8;
                <span class="ActionScriptDefault_Text">_lpFilterDamping</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_lpFilterDamping</span>;
                <span class="ActionScriptDefault_Text">_lpFilterOn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"lpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 1.0;
                
                <span class="ActionScriptDefault_Text">_hpFilterPos</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptDefault_Text">_hpFilterCutoff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"hpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"hpFilterCutoff"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.1;
                <span class="ActionScriptDefault_Text">_hpFilterDeltaCutoff</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"hpFilterCutoffSweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.0003;
                
                <span class="ActionScriptDefault_Text">_vibratoPhase</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptDefault_Text">_vibratoSpeed</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"vibratoSpeed"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"vibratoSpeed"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.01;
                <span class="ActionScriptDefault_Text">_vibratoAmplitude</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"vibratoDepth"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.5;
                
                <span class="ActionScriptDefault_Text">_envelopeVolume</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptDefault_Text">_envelopeStage</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">_envelopeTime</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">_envelopeLength0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"attackTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 100000.0;
                <span class="ActionScriptDefault_Text">_envelopeLength1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"sustainTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 100000.0;
                <span class="ActionScriptDefault_Text">_envelopeLength2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"decayTime"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 100000.0 <span class="ActionScriptOperator">+</span> 10;
                <span class="ActionScriptDefault_Text">_envelopeLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_envelopeLength0</span>;
                <span class="ActionScriptDefault_Text">_envelopeFullLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_envelopeLength0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_envelopeLength1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_envelopeLength2</span>;
                
                <span class="ActionScriptDefault_Text">_envelopeOverLength0</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_envelopeLength0</span>;
                <span class="ActionScriptDefault_Text">_envelopeOverLength1</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_envelopeLength1</span>;
                <span class="ActionScriptDefault_Text">_envelopeOverLength2</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_envelopeLength2</span>;
                
                <span class="ActionScriptDefault_Text">_flanger</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerOffset"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 0.0 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerSweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 0.0;
                
                <span class="ActionScriptDefault_Text">_flangerOffset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerOffset"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerOffset"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 1020.0;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerOffset"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_flangerOffset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_flangerOffset</span>;
                <span class="ActionScriptDefault_Text">_flangerDeltaOffset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerSweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerSweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flangerSweep"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.2;
                <span class="ActionScriptDefault_Text">_flangerPos</span> <span class="ActionScriptOperator">=</span> 0;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_flangerBuffer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_flangerBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>1024<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_noiseBuffer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_noiseBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>32<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_pinkNoiseBuffer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_pinkNoiseBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>32<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_loResNoiseBuffer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_loResNoiseBuffer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>32<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_pinkNumber</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_pinkNumber</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">PinkNumber</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 1024; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_flangerBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 32; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_noiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 2.0 <span class="ActionScriptOperator">-</span> 1.0;
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 32; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_pinkNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pinkNumber</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetNextValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 32; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_loResNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">%</span><span class="ActionScriptDefault_Text">LoResNoisePeriod</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>2.0<span class="ActionScriptOperator">-</span>1.0 : <span class="ActionScriptDefault_Text">_loResNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>;                            
            
                <span class="ActionScriptDefault_Text">_repeatTime</span> <span class="ActionScriptOperator">=</span> 0;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"repeatSpeed"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 0.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_repeatLimit</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptReserved">else</span>                         <span class="ActionScriptDefault_Text">_repeatLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span>1.0<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"repeatSpeed"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1.0<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"repeatSpeed"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 20000<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 32;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Writes the wave to the supplied buffer ByteArray
         * @param    buffer        A ByteArray to write the wave to
         * @param    waveData    If the wave should be written for the waveData
         * @return                If the wave is finished
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">synthWave</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">buffer</span>:<span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">length</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">waveData</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sampleRate</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 44100<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bitDepth</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 16<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_finished</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptDefault_Text">_sampleCount</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_bufferSample</span> <span class="ActionScriptOperator">=</span> 0.0;
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_finished</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;                    
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Repeats every _repeatLimit times, partially resetting the sound parameters
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_repeatLimit</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_repeatTime</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">_repeatLimit</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_repeatTime</span> <span class="ActionScriptOperator">=</span> 0;
                        <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_changePeriodTime</span><span class="ActionScriptOperator">++</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_changePeriodTime</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">_changePeriod</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>                
                    <span class="ActionScriptDefault_Text">_changeTime</span><span class="ActionScriptOperator">=</span>0;
                    <span class="ActionScriptDefault_Text">_changeTime2</span><span class="ActionScriptOperator">=</span>0;
                    <span class="ActionScriptDefault_Text">_changePeriodTime</span><span class="ActionScriptOperator">=</span>0;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_changeReached</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">_changeAmount</span>;
                        <span class="ActionScriptDefault_Text">_changeReached</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_changeReached2</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">_changeAmount2</span>;
                        <span class="ActionScriptDefault_Text">_changeReached2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// If _changeLimit is reached, shifts the pitch
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_changeReached</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_changeTime</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">_changeLimit</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_changeReached</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                        <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">_changeAmount</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// If _changeLimit is reached, shifts the pitch
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_changeReached2</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_changeTime2</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">_changeLimit2</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">_changeAmount2</span>;
                        <span class="ActionScriptDefault_Text">_changeReached2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Acccelerate and apply slide
</span>                <span class="ActionScriptDefault_Text">_slide</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_deltaSlide</span>;
                <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">_slide</span>;
                
                <span class="ActionScriptComment">// Checks for frequency getting too low, and stops the sound if a minFrequency was set
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">_maxPeriod</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_maxPeriod</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_minFreqency</span> <span class="ActionScriptOperator">&gt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_muted</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptBracket/Brace">}</span>                                        
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_periodTemp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_period</span>;
                
                <span class="ActionScriptComment">// Applies the vibrato effect
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_vibratoAmplitude</span> <span class="ActionScriptOperator">&gt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_vibratoPhase</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_vibratoSpeed</span>;
                    <span class="ActionScriptDefault_Text">_periodTemp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_period</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_vibratoPhase</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_vibratoAmplitude</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_periodTemp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_periodTemp</span> <span class="ActionScriptOperator">&lt;</span> 8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_periodTemp</span> <span class="ActionScriptOperator">=</span> 8;
                
                <span class="ActionScriptComment">// Sweeps the square duty
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveType</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_squareDuty</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_dutySweep</span>;
                         <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_squareDuty</span> <span class="ActionScriptOperator">&lt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_squareDuty</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_squareDuty</span> <span class="ActionScriptOperator">&gt;</span> 0.5<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_squareDuty</span> <span class="ActionScriptOperator">=</span> 0.5;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Moves through the different stages of the volume envelope
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_envelopeTime</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">_envelopeLength</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_envelopeTime</span> <span class="ActionScriptOperator">=</span> 0;
                    
                    <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_envelopeStage</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">case</span> 1: <span class="ActionScriptDefault_Text">_envelopeLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_envelopeLength1</span>; <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">case</span> 2: <span class="ActionScriptDefault_Text">_envelopeLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_envelopeLength2</span>; <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Sets the volume based on the position in the envelope
</span>                <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_envelopeStage</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> 0: <span class="ActionScriptDefault_Text">_envelopeVolume</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_envelopeTime</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_envelopeOverLength0</span>;                                     <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> 1: <span class="ActionScriptDefault_Text">_envelopeVolume</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_envelopeTime</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_envelopeOverLength1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 2.0 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_sustainPunch</span>; <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> 2: <span class="ActionScriptDefault_Text">_envelopeVolume</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_envelopeTime</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_envelopeOverLength2</span>;                                 <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> 3: <span class="ActionScriptDefault_Text">_envelopeVolume</span> <span class="ActionScriptOperator">=</span> 0.0; <span class="ActionScriptDefault_Text">_finished</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                                                     <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Moves the flanger offset
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flanger</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_flangerOffset</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_flangerDeltaOffset</span>;
                    <span class="ActionScriptDefault_Text">_flangerInt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flangerOffset</span><span class="ActionScriptBracket/Brace">)</span>;
                         <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flangerInt</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_flangerInt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_flangerInt</span>;
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flangerInt</span> <span class="ActionScriptOperator">&gt;</span> 1023<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_flangerInt</span> <span class="ActionScriptOperator">=</span> 1023;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Moves the high-pass filter cutoff
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_filters</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_hpFilterDeltaCutoff</span> <span class="ActionScriptOperator">!=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_hpFilterCutoff</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">_hpFilterDeltaCutoff</span>;
                         <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_hpFilterCutoff</span> <span class="ActionScriptOperator">&lt;</span> 0.00001<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_hpFilterCutoff</span> <span class="ActionScriptOperator">=</span> 0.00001;
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_hpFilterCutoff</span> <span class="ActionScriptOperator">&gt;</span> 0.1<span class="ActionScriptBracket/Brace">)</span>         <span class="ActionScriptDefault_Text">_hpFilterCutoff</span> <span class="ActionScriptOperator">=</span> 0.1;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Cycles through the period
</span>                    <span class="ActionScriptDefault_Text">_phase</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_phase</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_phase</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_phase</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_periodTemp</span>;
                        
                        <span class="ActionScriptComment">// Generates new random noise for this period
</span>                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveType</span> <span class="ActionScriptOperator">==</span> 3<span class="ActionScriptBracket/Brace">)</span> 
                        <span class="ActionScriptBracket/Brace">{</span> 
                            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">&lt;</span> 32; <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_noiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 2.0 <span class="ActionScriptOperator">-</span> 1.0;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveType</span> <span class="ActionScriptOperator">==</span> 5<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">&lt;</span> 32; <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_pinkNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pinkNumber</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetNextValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                            
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveType</span> <span class="ActionScriptOperator">==</span> 6<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">&lt;</span> 32; <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_loResNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">%</span><span class="ActionScriptDefault_Text">LoResNoisePeriod</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>2.0<span class="ActionScriptOperator">-</span>1.0 : <span class="ActionScriptDefault_Text">_loResNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>;                            
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptDefault_Text">_sample</span><span class="ActionScriptOperator">=</span>0;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">overtonestrength</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1;
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">&lt;=</span><span class="ActionScriptDefault_Text">_overtones</span>;<span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tempphase</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_phase</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span><span class="ActionScriptDefault_Text">_periodTemp</span>;
                        <span class="ActionScriptComment">// Gets the sample from the oscillator
</span>                        <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_waveType</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">case</span> 0: <span class="ActionScriptComment">// Square wave
</span>                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_squareDuty</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> 0.5 : <span class="ActionScriptOperator">-</span>0.5<span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 1: <span class="ActionScriptComment">// Saw wave
</span>                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 2.0<span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 2: <span class="ActionScriptComment">// Sine wave (fast and accurate approx)
</span>                            <span class="ActionScriptBracket/Brace">{</span>                                
                                 <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_periodTemp</span>;
                                 <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">&gt;</span> 0.5 <span class="ActionScriptOperator">?</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">-</span> 1.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 6.28318531 : <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> 6.28318531;
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tempsample</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 1.27323954 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">+</span> .405284735 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> : 1.27323954 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">-</span> 0.405284735 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span>;
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> .225 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">*</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tempsample</span> : .225 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span>;                                
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 3: <span class="ActionScriptComment">// Noise
</span>                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_noiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">*</span> 32 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span>32<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 4: <span class="ActionScriptComment">// Triangle Wave
</span>                            <span class="ActionScriptBracket/Brace">{</span>                        
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 5: <span class="ActionScriptComment">// Pink Noise
</span>                            <span class="ActionScriptBracket/Brace">{</span>                        
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_pinkNoiseBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">*</span> 32 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span>32<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 6: <span class="ActionScriptComment">// bipolar
</span>                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">//detuned
</span>                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tan</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tempphase</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">overtonestrength</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 7: <span class="ActionScriptComment">// Whistle 
</span>                            <span class="ActionScriptBracket/Brace">{</span>                
                                <span class="ActionScriptComment">// Sin wave code
</span>                                <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempphase</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_periodTemp</span>;
                                <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">&gt;</span> 0.5 <span class="ActionScriptOperator">?</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">-</span> 1.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 6.28318531 : <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> 6.28318531;
                                <span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 1.27323954 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">+</span> .405284735 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> : 1.27323954 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">-</span> 0.405284735 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span>;
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.75<span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> .225 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">*</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tempsample</span> : .225 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptComment">//then whistle (essentially an overtone with frequencyx20 and amplitude0.25
</span>                                
                                <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempphase</span><span class="ActionScriptOperator">*</span>20<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">%</span> <span class="ActionScriptDefault_Text">_periodTemp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_periodTemp</span>;
                                <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">&gt;</span> 0.5 <span class="ActionScriptOperator">?</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">-</span> 1.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 6.28318531 : <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> 6.28318531;
                                <span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 1.27323954 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">+</span> .405284735 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> : 1.27323954 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">-</span> 0.405284735 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_pos</span>;
                                <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">+=</span> 0.25<span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> .225 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">*</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tempsample</span> : .225 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_tempsample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tempsample</span><span class="ActionScriptBracket/Brace">)</span>;
                                
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">value</span>;<span class="ActionScriptComment">//main wave
</span>                                
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">case</span> 8: <span class="ActionScriptComment">// Up 
</span>                            <span class="ActionScriptBracket/Brace">{</span>    
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">amp</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempphase</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_periodTemp</span>;                                
                                <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">amp</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">amp</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptDefault_Text">overtonestrength</span><span class="ActionScriptOperator">*=</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_overtoneFalloff</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                    <span class="ActionScriptBracket/Brace">}</span>                    
                    
                    <span class="ActionScriptComment">// Applies the low and high pass filters
</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_filters</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_lpFilterOldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lpFilterPos</span>;
                        <span class="ActionScriptDefault_Text">_lpFilterCutoff</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">_lpFilterDeltaCutoff</span>;
                             <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lpFilterCutoff</span> <span class="ActionScriptOperator">&lt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_lpFilterCutoff</span> <span class="ActionScriptOperator">=</span> 0.0;
                        <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lpFilterCutoff</span> <span class="ActionScriptOperator">&gt;</span> 0.1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_lpFilterCutoff</span> <span class="ActionScriptOperator">=</span> 0.1;
                        
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lpFilterOn</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_lpFilterDeltaPos</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_lpFilterPos</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_lpFilterCutoff</span>;
                            <span class="ActionScriptDefault_Text">_lpFilterDeltaPos</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">_lpFilterDamping</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_lpFilterPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_sample</span>;
                            <span class="ActionScriptDefault_Text">_lpFilterDeltaPos</span> <span class="ActionScriptOperator">=</span> 0.0;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptDefault_Text">_lpFilterPos</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_lpFilterDeltaPos</span>;
                        
                        <span class="ActionScriptDefault_Text">_hpFilterPos</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_lpFilterPos</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_lpFilterOldPos</span>;
                        <span class="ActionScriptDefault_Text">_hpFilterPos</span> <span class="ActionScriptOperator">*=</span> 1.0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_hpFilterCutoff</span>;
                        <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_hpFilterPos</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptComment">// Applies the flanger effect
</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flanger</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_flangerBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_flangerPos</span><span class="ActionScriptOperator">&amp;</span>1023<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_sample</span>;
                        <span class="ActionScriptDefault_Text">_sample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_flangerBuffer</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flangerPos</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_flangerInt</span> <span class="ActionScriptOperator">+</span> 1024<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 1023<span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptDefault_Text">_flangerPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_flangerPos</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 1023;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_sample</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Averages out the super samples and applies volumes
</span>                <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_masterVolume</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_envelopeVolume</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">*</span> 0.125;                
                
                
                <span class="ActionScriptComment">//BIT CRUSH                
</span>                <span class="ActionScriptDefault_Text">_bitcrush_phase</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">_bitcrush_freq</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_bitcrush_phase</span><span class="ActionScriptOperator">&gt;</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_bitcrush_phase</span><span class="ActionScriptOperator">=</span>0;
                    <span class="ActionScriptDefault_Text">_bitcrush_last</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_superSample</span>;     
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">_bitcrush_freq</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_bitcrush_freq</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_bitcrush_freq_sweep</span><span class="ActionScriptOperator">,</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_superSample</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_bitcrush_last</span>;                 
            
                <span class="ActionScriptComment">// Clipping if too loud
</span>                     <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">&gt;</span> 1.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> 1.0;
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptOperator">-</span>1.0<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> -1.0;                                      
                 
                     
                     
                 <span class="ActionScriptComment">//compressor
</span>                     
                 <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_superSample</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span>
                 <span class="ActionScriptBracket/Brace">{</span>
                     <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_superSample</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_compression_factor</span><span class="ActionScriptBracket/Brace">)</span>;
                 <span class="ActionScriptBracket/Brace">}</span>
                 <span class="ActionScriptReserved">else</span>
                 <span class="ActionScriptBracket/Brace">{</span>
                     <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_superSample</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_compression_factor</span><span class="ActionScriptBracket/Brace">)</span>;
                 <span class="ActionScriptBracket/Brace">}</span>
                 
                 <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_muted</span><span class="ActionScriptBracket/Brace">)</span>
                 <span class="ActionScriptBracket/Brace">{</span>
                     <span class="ActionScriptDefault_Text">_superSample</span> <span class="ActionScriptOperator">=</span> 0;
                 <span class="ActionScriptBracket/Brace">}</span>
                 
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">waveData</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Writes same value to left and right channels
</span>                    <span class="ActionScriptDefault_Text">buffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_superSample</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">buffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_superSample</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_bufferSample</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_superSample</span>;
                    
                    <span class="ActionScriptDefault_Text">_sampleCount</span><span class="ActionScriptOperator">++</span>;
                    
                    <span class="ActionScriptComment">// Writes mono wave data to the .wav format
</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sampleRate</span> <span class="ActionScriptOperator">==</span> 44100 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_sampleCount</span> <span class="ActionScriptOperator">==</span> 2<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_bufferSample</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">_sampleCount</span>;
                        <span class="ActionScriptDefault_Text">_sampleCount</span> <span class="ActionScriptOperator">=</span> 0;
                        
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitDepth</span> <span class="ActionScriptOperator">==</span> 16<span class="ActionScriptBracket/Brace">)</span>     <span class="ActionScriptDefault_Text">buffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span>32000.0 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_bufferSample</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">else</span>                 <span class="ActionScriptDefault_Text">buffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_bufferSample</span> <span class="ActionScriptOperator">*</span> 127 <span class="ActionScriptOperator">+</span> 128<span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptDefault_Text">_bufferSample</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        <span class="ActionScriptComment">//    
</span>        <span class="ActionScriptComment">//  .wav File Methods
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">//--------------------------------------------------------------------------
</span>        
        <span class="ActionScriptASDoc">/**
         * Returns a ByteArray of the wave in the form of a .wav file, ready to be saved out
         * @return                    Wave in a .wav file
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getWavFile</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ByteArray</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ww</span>:<span class="ActionScriptDefault_Text">WaveWriter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">WaveWriter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptOperator">,</span>32<span class="ActionScriptBracket/Brace">)</span>;            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cw</span>:<span class="ActionScriptDefault_Text">ByteArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cachedWave</span>;            
            <span class="ActionScriptDefault_Text">ww</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addSamples</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cw</span><span class="ActionScriptBracket/Brace">)</span>;            
            <span class="ActionScriptDefault_Text">ww</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">finalize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">ww</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outBuffer</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
